# app/config/amadeus_semantic_layer.yaml
domain: amadeus_airport_ops
version: "1.0"

defaults:
  timeframe_days: 30
  top_n: 5
  limit_preview: 50
  dimension: airport

  # If user says "avg wait time" without specifying which queue → assume Security (most common)
  default_wait_time_metric: security_wait_time_avg

  # If user says "higher than avg wait time" → baseline for "avg wait time"
  # (your query_rewriter uses this to avoid cheap clarification)
  default_comparison_baseline_metric: overall_wait_time_avg


# Canonical metrics used by downstream SQL generation.
# IMPORTANT: keep keys aligned with what your SQL generator expects.
metrics:
  security_wait_time_avg:
    synonyms:
      - "security wait time"
      - "avg security wait"
      - "average security wait time"
      - "security queue time"
      - "tsa wait"
      - "pre-security wait"
      - "pre security wait"
      - "security screening time"
    unit: "minutes"
    description: "Average security wait time in minutes"

  checkin_wait_time_avg:
    synonyms:
      - "checkin wait time"
      - "check-in wait time"
      - "check-in wait"
      - "average checkin wait time"
      - "average check-in wait time"
      - "bag drop wait"
      - "counter wait time"
    unit: "minutes"
    description: "Average check-in wait time in minutes"

  overall_wait_time_avg:
    synonyms:
      - "avg wait time"
      - "average wait time"
      - "overall wait time"
      - "total wait time"
      - "end to end wait time"
      - "e2e wait time"
      - "airport wait time"
    unit: "minutes"
    description: "Overall average wait time (as defined in gold layer)"

  passenger_count:
    synonyms:
      - "passenger count"
      - "passengers"
      - "pax"
      - "throughput"
      - "traffic"
      - "volume"
    unit: "count"
    description: "Total passenger count"


# Canonical dimensions (to help rewriter + generator stay consistent)
dimensions:
  airport:
    synonyms:
      - "airport"
      - "airports"
      - "station"
      - "location"
    id_fields:
      - "airport_code"
      - "iata_code"
      - "airport_name"

  terminal:
    synonyms:
      - "terminal"
      - "terminals"
    id_fields:
      - "terminal_id"
      - "terminal_name"

  checkpoint:
    synonyms:
      - "checkpoint"
      - "security checkpoint"
      - "lane"
    id_fields:
      - "checkpoint_id"
      - "checkpoint_name"

  date:
    synonyms:
      - "date"
      - "day"
    id_fields:
      - "event_date"


timeframe_patterns:
  - pattern: "last {n} days"
    type: "days"
  - pattern: "past {n} days"
    type: "days"
  - pattern: "last {n} months"
    type: "months"
  - pattern: "past {n} months"
    type: "months"
  - pattern: "last month"
    type: "last_month"
  - pattern: "last week"
    type: "last_week"
  - pattern: "today"
    type: "today"
  - pattern: "yesterday"
    type: "yesterday"


# When user says "top" / "highest" / "worst" etc.
ranking_intents:
  top:
    synonyms: ["top", "highest", "max", "largest", "most", "worst"]
    sort: "desc"
  bottom:
    synonyms: ["bottom", "lowest", "min", "smallest", "least", "best"]
    sort: "asc"


# Prefer assumptions over stopping the flow.
clarification_policy:
  max_questions: 1

  # Prefer assumptions when ambiguity can be resolved by defaults
  prefer_assumptions: true

  # Only clarify if we truly cannot map to metric/dimension needed for SQL
  clarify_only_if_unmappable: true

  # Optional: keep your previous rules (they won't force clarification if above flags resolve)
  ask_only_if:
    - missing_metric_and_no_synonym_match
    - missing_required_dimension_for_non_default_query


normalization_map:
  "ahh": "avg"
  "airpot": "airport"
  "airpots": "airports"
  "avgg": "avg"
  "sec": "security"
  "chk in": "check-in"
  "check in": "check-in"
  "pax": "passengers"